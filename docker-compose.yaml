version: "3.7"
networks:
  tracker-network:
    driver: bridge
  location-network:
    driver: bridge
services:
  trackit-redis:
    container_name: trackit-redis
    image: "redis:alpine"
    networks:
      - tracker-network
    restart: on-failure

  trackit-rabbit:
    container_name: trackit-rabbit
    image: "rabbitmq:3-management"
    ports:
        - "5672:5672"
        - "8000:15672"
    networks:
      - tracker-network
      - location-network
    restart: on-failure

  trackit-postgres:
    container_name: trackit-postgres
    image: postgres:13
    restart: always
    environment:
      POSTGRES_PASSWORD: pass
      POSTGRES_USER: user
      POSTGRES_DB: TrackItDB
    ports:
      - "5432:5432"
    networks:
      - location-network

  tracker-service:
    build:
      context: ./tracker-service
      dockerfile: Dockerfile
    ports:
      - "9000:9000"
    networks:
      - tracker-network
    depends_on:
      - trackit-redis
      - trackit-rabbit
    restart: on-failure
    environment:
      - SPRING_REDIS_HOST=trackit-redis
      - SPRING_RABBITMQ_HOST=trackit-rabbit


  location-service:
    build:
      context: ./location-service
      dockerfile: Dockerfile
    ports:
      - "8090:8090"
    networks:
      - location-network
    depends_on:
      - trackit-rabbit
      - trackit-postgres
    restart: on-failure
    environment:
      - SPRING_RABBITMQ_HOST=trackit-rabbit
      - DATABASE_HOST=trackit-postgres
      - DATABASE_PASS=pass
      - DATABASE_USER=user

  trackit-ui:
    build:
      context: ./track-it-ui
      dockerfile: Dockerfile
    ports:
    - "80:80"
    networks:
      - location-network
    restart: on-failure
